---
/** ContactForm — mobile-first, brand-consistent, Fix Plan 62
 * Props:
 *  action?: string                     // form endpoint (defaults to Formspree)
 *  method?: 'POST' | 'GET'             // default 'POST'
 *  whatsappHref?: string               // retained for API compatibility (not rendered here)
 *  packageParam?: string               // query param name to capture (default 'package')
 *  showFile?: boolean                  // toggle CV upload field
 *  accept?: string                     // file accept list
 *  class?: string                      // extra classes on root
 */

export interface Props {
  action?: string;
  method?: 'POST' | 'GET';
  whatsappHref?: string;
  packageParam?: string;
  showFile?: boolean;
  accept?: string;
  class?: string;
}

const {
  action = 'https://formspree.io/f/mayvdvbg',
  method = 'POST',
  whatsappHref = 'https://wa.me/254712345678',
  packageParam = 'package',
  showFile = true,
  accept = '.pdf,.doc,.docx,.rtf',
  class: className = ''
} = Astro.props as Props;

const pkg = Astro.url?.searchParams?.get(packageParam) ?? '';
---

import "./ContactForm.css";

<form
  class={`contactform ${className}`.trim()}
  data-section="contactform"
  name="contact"
  action={action}
  method={method}
  enctype="multipart/form-data"
  autocomplete="on"
>
  <!-- spam honeypot -->
  <input type="text" name="website" class="hp" tabindex="-1" aria-hidden="true" />

  <div class="contactform__grid">
    <!-- Full name (required) -->
    <div class="field">
      <label for="cf-name" class="label">
        Full name <span class="req" aria-hidden="true">*</span>
      </label>
      <input
        id="cf-name"
        name="name"
        type="text"
        required
        autocomplete="name"
        class="input"
        aria-required="true"
      />
    </div>

    <!-- Email address (required) -->
    <div class="field">
      <label for="cf-email" class="label">
        Email address <span class="req" aria-hidden="true">*</span>
      </label>
      <input
        id="cf-email"
        name="email"
        type="email"
        inputmode="email"
        autocomplete="email"
        required
        class="input"
        aria-required="true"
      />
    </div>

    <!-- Service needed (required) -->
    <div class="field">
      <label for="cf-service" class="label">
        Service needed <span class="req" aria-hidden="true">*</span>
      </label>
      <select
        id="cf-service"
        name="service"
        required
        class="select"
        aria-required="true"
      >
        <option value="">Select service…</option>
        <option value="new-cv">New CV</option>
        <option value="cv-cover-letter">CV + Cover Letter</option>
        <option value="cv-linkedin">CV + LinkedIn Profile</option>
        <option value="other">Other (please specify in your message)</option>
      </select>
    </div>

    <!-- Country (optional; Kenya pinned at top) -->
    <div class="field">
      <label for="cf-country" class="label">
        Country (optional)
      </label>
      <select
        id="cf-country"
        name="country"
        class="select"
      >
        <option value="">Select country…</option>
        <option value="Kenya">Kenya</option>
        <option value="Other">Other (specify in your message)</option>
      </select>
    </div>

    <!-- Message (full width, primary context) -->
    <div class="field field--full">
      <label for="cf-message" class="label">
        Message
      </label>
      <textarea
        id="cf-message"
        name="message"
        rows="4"
        class="textarea"
        placeholder="Tell us about your current role, target role, and any deadlines."
        aria-describedby="cf-message-help"
      ></textarea>
      <p id="cf-message-help" class="help">
        Include any context that helps us understand your situation and timelines.
      </p>
    </div>

    <!-- Optional CV upload -->
    {showFile && (
      <div class="field field--full">
        <label for="cf-file" class="label">
          Attach your current CV (optional)
        </label>
        <input
          id="cf-file"
          name="file"
          type="file"
          class="file"
          accept={accept}
        />
        <p class="help">Accepted: PDF, DOC, DOCX, RTF.</p>
      </div>
    )}
  </div>

  <!-- capture package / context -->
  <input type="hidden" name={packageParam} value={pkg} />

  <!-- IA microcopy under the form -->
  <p class="help contactform__summary">
    We’ll review your details and reply with a clear recommendation and next steps.
  </p>
  <p class="help contactform__privacy">
    We only use your details to respond to your enquiry. No mailing lists, no spam.
  </p>

  <div class="contactform__actions">
    <button type="submit" class="btn btn-primary" data-cta="contact-submit">
      <span class="btn__inner">
        <span class="btn__label">Send message</span>
      </span>
    </button>
  </div>
</form>
