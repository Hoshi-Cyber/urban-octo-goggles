---
import "./TestimonialCard.css";

export interface Props {
  quote: string;
  author: string;
  role?: string;
  avatarSrc?: string;
  rating?: number;
  highlight?: boolean;
  class?: string;
}

const {
  quote,
  author,
  role,
  avatarSrc,
  rating = 0,
  highlight = false,
  class: className = "",
} = Astro.props as Props;

const safeRating = Math.max(0, Math.min(5, Math.round(rating)));
---

<article
  class={`testimonial-card ${highlight ? "testimonial-card--highlight" : ""} ${className}`}
  data-section="testimonial-card"
>
  <figure class="testimonial-card__figure">
    {avatarSrc && (
      <img
        class="testimonial-card__avatar"
        src={avatarSrc}
        alt={`Avatar of ${author}`}
        width="64"
        height="64"
        loading="lazy"
        decoding="async"
      />
    )}

    <blockquote class="testimonial-card__quote">
      <span class="sr-only">Testimonial:</span>
      {quote}
    </blockquote>

    <figcaption class="testimonial-card__meta">
      <span class="testimonial-card__author">{author}</span>
      {role && <span class="testimonial-card__role">{role}</span>}
    </figcaption>

    {safeRating > 0 && (
      <div
        class="testimonial-card__rating"
        role="img"
        aria-label={`${safeRating} out of 5 stars`}
      >
        {Array.from({ length: 5 }).map((_, i) => (
          <span
            class={`testimonial-card__star ${i < safeRating ? "is-filled" : ""}`}
            aria-hidden="true"
          >
            â˜…
          </span>
        ))}
      </div>
    )}
  </figure>
</article>
