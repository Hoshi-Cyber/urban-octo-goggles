---
// src/components/cta/Button/index.astro
/** Button â€” mobile-first, token-driven,
 * Polymorphic: <a> if href, else <button>.
 */

export interface Props {
  label: string;
  href?: string;
  variant?: "primary" | "accent" | "ghost" | "link";
  size?: "sm" | "md" | "lg";
  block?: boolean;
  disabled?: boolean;
  cta?: string;
  target?: "_self" | "_blank";
  rel?: string;
  ariaLabel?: string;
  class?: string;

  /** Optional visual tone modifier layered on top of the variant */
  tone?: "default" | "success" | "danger" | "subtle";

  /** Optional loading state: disables interaction and shows spinner */
  loading?: boolean;

  /** Icon-only button; hides visible label but keeps it for a11y */
  iconOnly?: boolean;
}

const {
  label,
  href,
  variant = "primary",
  size = "md",
  block = false,
  disabled = false,
  cta,
  target,
  rel,
  ariaLabel,
  class: className = "",
  tone = "default",
  loading = false,
  iconOnly = false,
} = Astro.props as Props;

const variantClass =
  variant === "accent"
    ? "btn-accent"
    : variant === "ghost"
    ? "btn-ghost"
    : variant === "link"
    ? "btn-link"
    : "btn-primary";

const sizeClass =
  size === "sm" ? "btn-sm" : size === "lg" ? "btn-lg" : "btn-md";

const blockClass = block ? "btn-block" : "";

const toneClass =
  tone === "success"
    ? "btn-tone-success"
    : tone === "danger"
    ? "btn-tone-danger"
    : tone === "subtle"
    ? "btn-tone-subtle"
    : "";

const iconOnlyClass = iconOnly ? "btn--iconOnly" : "";
const loadingClass = loading ? "is-loading" : "";

const resolvedTarget = target ?? undefined;
const resolvedRel =
  resolvedTarget === "_blank" ? rel ?? "noopener" : rel ?? undefined;

const dataCta = cta ?? `btn-${variant}`;

// Only apply aria-label when it adds extra information beyond the visible label
const ariaLabelAttr =
  ariaLabel && ariaLabel !== label ? ariaLabel : undefined;

// When loading, treat as disabled for interaction
const isDisabled = disabled || loading;

import "./Button.css";
---

{href ? (
  <a
    href={isDisabled ? undefined : href}
    class={`btn ${variantClass} ${sizeClass} ${blockClass} ${toneClass} ${iconOnlyClass} ${loadingClass} ${className}`.trim()}
    aria-label={ariaLabelAttr}
    data-cta={dataCta}
    {...(resolvedTarget ? { target: resolvedTarget } : {})}
    {...(resolvedRel ? { rel: resolvedRel } : {})}
    aria-disabled={isDisabled ? "true" : undefined}
    aria-busy={loading ? "true" : undefined}
    tabindex={isDisabled ? -1 : undefined}
  >
    <span class="btn__inner">
      <slot name="icon-left" />
      <span class={`btn__label${iconOnly ? " btn__label--srOnly" : ""}`}>
        {label}
      </span>
      <slot name="icon-right" />
    </span>
  </a>
) : (
  <button
    type="button"
    class={`btn ${variantClass} ${sizeClass} ${blockClass} ${toneClass} ${iconOnlyClass} ${loadingClass} ${className}`.trim()}
    aria-label={ariaLabelAttr}
    data-cta={dataCta}
    disabled={isDisabled}
    aria-busy={loading ? "true" : undefined}
  >
    <span class="btn__inner">
      <slot name="icon-left" />
      <span class={`btn__label${iconOnly ? " btn__label--srOnly" : ""}`}>
        {label}
      </span>
      <slot name="icon-right" />
    </span>
  </button>
)}
