---
/*
  File: src/components/blog/post/ChecklistSection/index.astro

  Purpose (Fix Plan 006 Step 4.4 – ChecklistSection):
  - Provide a reusable “Implementation checklist” band for blog posts and marketing pages.
  - Wrap the generic ui/Checklist component with:
    • Section framing (eyebrow, title, lead copy).
    • Blog-layout-aware container and spacing.
  - Keep this component PRESENTATIONAL ONLY:
    • No data fetching.
    • No IA decisions (that’s handled in BlogPostLayout + playbooks).
    • Accept normalised props from the route layer.

  Notes:
  - This component is optional and only rendered when there are checklist items.
  - Heading level can be controlled via `headingLevel` to maintain a valid outline.
*/

import Checklist from "@/components/ui/Checklist";

export interface ChecklistSectionProps {
  /** Section title, e.g. “Implementation checklist” */
  title?: string;
  /**
   * Optional short HTML lead/intro paragraph rendered under the title.
   * Must be sanitised upstream; rendered via set:html.
   */
  leadHtml?: string;
  /**
   * Ordered list of implementation steps.
   * Each string becomes a single checklist row label.
   */
  items: string[];
  /**
   * Heading level for the title, used to fit into the page outline.
   * Default: 2 (renders <h2>).
   */
  headingLevel?: 2 | 3;
  /**
   * Optional small eyebrow above the title for context.
   * Example: “Action steps you can take next”.
   */
  eyebrow?: string;
}

const {
  title = "Implementation checklist",
  leadHtml,
  items = [],
  headingLevel = 2,
  eyebrow = "Action steps you can take next",
} = Astro.props as ChecklistSectionProps;

const hasItems = Array.isArray(items) && items.length > 0;
const listItems = hasItems ? items.map((label) => ({ label })) : [];

// Precompute for accessibility; avoid empty aria-labels.
const sectionLabel =
  title && title.trim().length > 0
    ? title
    : "Implementation checklist";

const sheet = new URL("./ChecklistSection.css", import.meta.url).toString();
---

{hasItems && (
  <>
    <link rel="stylesheet" href={sheet} />

    <section
      class="checklist-section"
      aria-label={sectionLabel}
    >
      <div class="container checklist-section__container">
        <div class="checklist-section__inner">
          <header class="checklist-section__header">
            {eyebrow && (
              <p class="checklist-section__eyebrow">
                {eyebrow}
              </p>
            )}

            {title && headingLevel === 3 && (
              <h3 class="checklist-section__title">
                {title}
              </h3>
            )}

            {title && headingLevel !== 3 && (
              <h2 class="checklist-section__title">
                {title}
              </h2>
            )}

            {leadHtml && (
              <div
                class="checklist-section__lead"
                set:html={leadHtml}
              />
            )}
          </header>

          <Checklist items={listItems} />
        </div>
      </div>
    </section>
  </>
)}
