---
// src/components/blog/compose/CategoryGrid/index.astro

import "./CategoryGrid.css";

export interface CategoryCard {
  icon?: string; // inline SVG string (optional)
  title: string;
  blurb: string;
  href: string;
  count?: number;
}

interface Props {
  eyebrow?: string;
  title?: string;
  items: CategoryCard[];
  class?: string;
}

const { eyebrow, title, items, class: className } = Astro.props as Props;

const VARIANTS = ["a", "b", "c", "d"];

const baseId = "blog-explore-categories";
const resolvedTitle =
  typeof title === "string" && title.trim().length > 0
    ? title
    : "Explore categories";

const sectionId =
  resolvedTitle === "Explore categories"
    ? baseId
    : `${baseId}-${resolvedTitle.toLowerCase().replace(/[^a-z0-9]+/g, "-")}`;
---

<section
  class={`catgrid ${className ?? ""}`}
  aria-labelledby={sectionId}
>
  {/* Header: left-aligned, eyebrow directly above title, width constrained by container */}
  <header class="catgrid__head container stack section-head">
    {eyebrow && <p class="catgrid__eyebrow">{eyebrow}</p>}

    <h2 id={sectionId} class="section-title catgrid__title">
      {resolvedTitle}
    </h2>
  </header>

  {/* Grid: full-width across the section, no container wrapping the cards */}
  {items?.length > 0 && (
    <ul
      class="cat-grid"
      role="list"
      aria-label={resolvedTitle}
    >
      {items.map((item, index) => {
        const variant = VARIANTS[index % VARIANTS.length];
        const hasCount =
          typeof item.count === "number" && item.count > 0;
        const countLabel = hasCount
          ? `${item.count} ${item.count === 1 ? "post" : "posts"}`
          : "";
        const cardLabel = hasCount
          ? `${item.title}, ${countLabel}`
          : item.title;

        return (
          <li class={`cat cat--${variant}`}>
            <a
              href={item.href}
              class="cat__link card"
              aria-label={cardLabel}
            >
              {item.icon && (
                <div
                  class="cat__icon"
                  aria-hidden="true"
                  set:html={item.icon}
                />
              )}

              <div class="cat__body">
                <h3 class="cat__title">{item.title}</h3>

                {item.blurb && (
                  <p class="cat__desc">
                    {item.blurb}
                  </p>
                )}

                {hasCount && (
                  <span class="cat__count">
                    {countLabel}
                  </span>
                )}
              </div>

              <span class="cat__chev" aria-hidden="true">
                â†’
              </span>
            </a>
          </li>
        );
      })}
    </ul>
  )}
</section>
