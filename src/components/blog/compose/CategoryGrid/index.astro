---
// src/components/blog/compose/CategoryGrid/index.astro
// Premium blog category grid – 1/2/4 layout with equal-height cards,
// width-aligned to other sections via a shared .container wrapper.

import "./CategoryGrid.css";

export interface CategoryCard {
  icon?: string; // inline SVG string (optional)
  title: string;
  blurb: string;
  href: string;
  count?: number;
}

interface Props {
  eyebrow?: string;
  title?: string;
  items: CategoryCard[];
  class?: string;
  /**
   * Optional: mark one category as the currently active/selected category.
   * Useful on category index pages to show which topic is being viewed.
   */
  activeHref?: string;
  /**
   * Optional: render a slightly denser variant with reduced vertical padding.
   * Useful when CategoryGrid is used in tighter layouts.
   */
  compact?: boolean;
}

const {
  eyebrow,
  title,
  items,
  class: className,
  activeHref,
  compact = false,
} = Astro.props as Props;

const VARIANTS = ["a", "b", "c", "d"];

const baseId = "blog-explore-categories";
const resolvedTitle =
  typeof title === "string" && title.trim().length > 0
    ? title
    : "Explore categories";

const sectionId =
  resolvedTitle === "Explore categories"
    ? baseId
    : `${baseId}-${resolvedTitle
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "")}`;

const sectionClass = [
  "catgrid",
  "section",
  compact ? "catgrid--compact" : "",
  className ?? "",
]
  .filter(Boolean)
  .join(" ");
---

<section
  class={sectionClass}
  data-section="blog-category-grid"
  aria-labelledby={sectionId}
>
  <div class="container">
    {/* Header: left-aligned, eyebrow directly above title, aligned to container */}
    <header class="catgrid__head stack section-head">
      {eyebrow && <p class="catgrid__eyebrow">{eyebrow}</p>}

      {/* h2 with global section-title styling + local underline accent */}
      <h2 id={sectionId} class="section-title catgrid__title">
        {resolvedTitle}
      </h2>
    </header>

    {/* Grid: aligned to the same container width as other sections */}
    {items?.length > 0 && (
      <ul class="cat-grid" role="list" aria-label={resolvedTitle}>
        {items.map((item, index) => {
          const variant = VARIANTS[index % VARIANTS.length];
          const hasCount = typeof item.count === "number" && item.count > 0;
          const countLabel = hasCount
            ? `${item.count} ${item.count === 1 ? "Post" : "Posts"}`
            : "";
          const cardLabel = hasCount
            ? `${item.title}, ${countLabel}`
            : item.title;
          const isActive = typeof activeHref === "string" &&
            activeHref.trim().length > 0 &&
            item.href === activeHref;

          const liClass = [
            "cat",
            `cat--${variant}`,
            isActive ? "cat--active" : "",
          ]
            .filter(Boolean)
            .join(" ");

          return (
            <li class={liClass}>
              <a
                href={item.href}
                class="cat__link card"
                aria-label={cardLabel}
                data-cta="blog-category"
                aria-current={isActive ? "page" : undefined}
              >
                {item.icon && (
                  <div
                    class="cat__icon"
                    aria-hidden="true"
                    set:html={item.icon}
                  />
                )}

                <div class="cat__body">
                  <h3 class="cat__title">{item.title}</h3>

                  {item.blurb && (
                    <p class="cat__desc">
                      {item.blurb}
                    </p>
                  )}

                  {hasCount && <span class="cat__count">{countLabel}</span>}
                </div>

                <span class="cat__chev" aria-hidden="true">
                  →
                </span>
              </a>
            </li>
          );
        })}
      </ul>
    )}
  </div>
</section>
