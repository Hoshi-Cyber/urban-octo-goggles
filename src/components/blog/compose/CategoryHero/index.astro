---
// File: src/components/blog/compose/CategoryHero/index.astro

import css from "./CategoryHero.css?url";

export interface Cta { href: string; label: string }
export interface Stats {
  postCount?: number;
  lastUpdated?: string | Date;
  readRange?: string; // e.g., "3â€“7 min"
}
export interface Props {
  title: string;
  dek?: string;
  stats?: Stats;
  primaryCta?: Cta;
  secondaryCta?: Cta;
  /** Fix Plan 158: do NOT add inner horizontal gutters by default */
  contained?: boolean; // if true, allow an inner container (defaults to false)
}

const {
  title,
  dek,
  stats = {},
  primaryCta,
  secondaryCta,
  contained = false,
} = Astro.props as Props;

function fmtDate(d?: string | Date) {
  if (!d) return null;
  try {
    const date = typeof d === "string" ? new Date(d) : d;
    return date.toLocaleDateString("en-KE", { year: "numeric", month: "short" });
  } catch {
    return null;
  }
}

const lastUpdatedText = fmtDate(stats.lastUpdated);
const statBits = [
  typeof stats.postCount === "number" ? `${stats.postCount} posts` : null,
  lastUpdatedText ? `Updated ${lastUpdatedText}` : null,
  stats.readRange ? stats.readRange : null
].filter(Boolean) as string[];

const dekId = "category-hero-dek";
const titleId = "category-hero-title";

/** Detect optional media slot; grid activates at lg only when media exists */
const hasMedia = Astro.slots.has?.("media") === true;
---
<section
  class="category-hero"
  data-section="category-hero"
  data-contained={String(contained)}
  data-has-media={String(hasMedia)}
  aria-labelledby={titleId}
>
  <link rel="stylesheet" href={css} />

  {/*
    Fix Plan 158:
    - No inner container/gutters by default; rely on page-level .container for horizontal padding.
    - Keep only padding-block in CSS (no padding-inline).
    - Single column by default; grid only at lg when media exists.
  */}
  <div class:list={[
    "category-hero__grid",
    hasMedia ? "has-media" : "no-media",
    contained ? "is-contained" : "is-uncontained",
  ]}>
    <header class="category-hero__head">
      <p class="category-hero__eyebrow">Blog Category</p>
      <h1 id={titleId} class="category-hero__title">{title}</h1>

      {dek && <p id={dekId} class="category-hero__dek">{dek}</p>}

      {statBits.length > 0 && (
        <ul class="category-hero__stats" aria-label="Category metrics">
          {statBits.map((s) => <li class="category-hero__stat">{s}</li>)}
        </ul>
      )}

      {(primaryCta || secondaryCta) && (
        <div class="category-hero__ctas">
          {primaryCta && (
            <a
              class="btn btn-primary"
              href={primaryCta.href}
              data-cta="category-primary"
              aria-describedby={dek ? dekId : undefined}
            >
              {primaryCta.label}
            </a>
          )}
          {secondaryCta && (
            <a
              class="btn btn-accent"
              href={secondaryCta.href}
              data-cta="category-secondary"
              aria-describedby={dek ? dekId : undefined}
            >
              {secondaryCta.label}
            </a>
          )}
        </div>
      )}
    </header>

    {hasMedia && (
      <div class="category-hero__media" aria-hidden="true">
        <slot name="media" />
      </div>
    )}
  </div>
</section>
