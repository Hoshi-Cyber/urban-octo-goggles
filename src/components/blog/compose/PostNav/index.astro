---
// src/components/blog/compose/PostNav/index.astro

import sheet from "./PostNav.css?url";
import type {
  PostNavProps,
  PostNavItemInput,
  NavItemResolved,
  SimplePostItem,
  LegacyPostItem,
} from "./types";

const { prev = null, next = null } = Astro.props as PostNavProps;

const normalizeItem = (item?: PostNavItemInput | null): NavItemResolved | null => {
  if (!item) return null;

  // Legacy shape: { data: { title, category, ... }, slug }
  if ("data" in item) {
    const legacy = item as LegacyPostItem;
    const title = legacy.data?.title;
    const category = legacy.data?.category;
    const slug = legacy.slug;
    // Prefer an explicit URL if present in data, otherwise fall back to
    // the canonical blog route shape for backward compatibility.
    const explicitUrl = (legacy.data as any)?.url as string | undefined;
    const fallbackUrl =
      category && slug ? `/blog/${category}/${slug}/` : undefined;
    const href = explicitUrl ?? fallbackUrl;

    if (!title || !href) return null;

    return { title, href, category };
  }

  // New shape: { title, url, category? }
  const simple = item as SimplePostItem;
  if (!simple.title || !simple.url) return null;

  return {
    title: simple.title,
    href: simple.url,
    category: simple.category,
  };
};

const prevItem = normalizeItem(prev);
const nextItem = normalizeItem(next);
const hasAny = Boolean(prevItem || nextItem);
---
<link rel="stylesheet" href={sheet} />

{hasAny && (
  <div class="postNav" role="group" aria-label="Previous and next articles">
    {prevItem && (
      <a
        class="postNav__card postNav__card--prev"
        href={prevItem.href}
        rel="prev"
      >
        <span class="postNav__label">Previous article</span>
        <span class="postNav__title">{prevItem.title}</span>
      </a>
    )}

    {nextItem && (
      <a
        class="postNav__card postNav__card--next"
        href={nextItem.href}
        rel="next"
      >
        <span class="postNav__label">Next article</span>
        <span class="postNav__title">{nextItem.title}</span>
      </a>
    )}
  </div>
)}
