---
// BlogHero â€” mobile-first hero with dual CTAs and optional cover.
// Grid only at lg+ AND only when media is present.

import css from "./BlogHero.css?url";

export interface Cover {
  src: string;
  alt?: string;
  width?: number;
  height?: number;
}

export interface Props {
  title: string;
  sub?: string;
  primaryHref?: string;
  primaryLabel?: string;
  secondaryHref?: string;
  secondaryLabel?: string;
  cover?: Cover | null;
  contained?: boolean;
}

const {
  title,
  sub = "",
  primaryHref = "/contact/",
  primaryLabel = "Get Professional CV Help",
  secondaryHref = "/blog/",
  secondaryLabel = "Read Latest",
  cover = null,
  contained = false,
} = Astro.props as Props;

const titleId = "bloghero-title";
const hasDek = sub.trim().length > 0;
const dekId = hasDek ? "bloghero-dek" : undefined;

// Media presence
const hasMedia = Boolean(cover?.src);

// Alt text hygiene: hide purely decorative / placeholder-like images
const rawAlt = (cover?.alt ?? "").trim();
const normalizedAlt = rawAlt.toLowerCase();
const isPlaceholderAlt =
  !normalizedAlt ||
  normalizedAlt === "blog hero" ||
  normalizedAlt === "blog cover";
const hasDescriptiveAlt = Boolean(normalizedAlt) && !isPlaceholderAlt;

const imgAlt = hasDescriptiveAlt ? rawAlt : "";
const figureAriaHidden = hasDescriptiveAlt ? undefined : "true";
---

<link rel="stylesheet" href={css} />

<section
  class="bloghero"
  data-section="blog-hero"
  data-contained={String(contained)}
  data-has-media={String(hasMedia)}
  aria-labelledby={titleId}
>
  <div
    class:list={[
      "container",
      "bloghero__grid",
      hasMedia ? "has-media" : "no-media",
      contained ? "is-contained" : "is-uncontained",
    ]}
  >
    <div class="bloghero__copy stack">
      <h1 id={titleId} class="bloghero__title section-title h1">
        {title}
      </h1>

      {hasDek && (
        <p id="bloghero-dek" class="bloghero__sub">
          {sub}
        </p>
      )}

      <div class="bloghero__ctas">
        {primaryHref && primaryLabel && (
          <a
            href={primaryHref}
            class="btn btn-primary"
            data-cta="bloghero-primary"
            aria-describedby={dekId}
          >
            {primaryLabel}
          </a>
        )}

        {secondaryHref && secondaryLabel && (
          <a
            href={secondaryHref}
            class="btn btn-accent"
            data-cta="bloghero-secondary"
            aria-describedby={dekId}
          >
            {secondaryLabel}
          </a>
        )}
      </div>
    </div>

    {hasMedia && (
      <figure class="bloghero__media" aria-hidden={figureAriaHidden}>
        <img
          src={cover!.src}
          alt={imgAlt}
          width={cover!.width ?? 960}
          height={cover!.height ?? 720}
          loading="lazy"
          decoding="async"
        />
      </figure>
    )}
  </div>
</section>
