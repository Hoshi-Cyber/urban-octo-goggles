---
// src/components/blog/compose/PostToc/index.astro

import css from "./PostToc.css?url";
import type { TocProps, TocHeading } from "./types";

const { headings = [] } = Astro.props as TocProps;

// Only allow H2/H3-level headings
const items: TocHeading[] = headings.filter(
  (h) => h && (h.depth === 2 || h.depth === 3),
);

// Require a sensible minimum number of headings
const MIN_ITEMS = 3;
const showToc = items.length >= MIN_ITEMS;
---
<link rel="stylesheet" href={css} />

{showToc && (
  <nav class="post__toc" aria-labelledby="post-toc-title">
    <h2 id="post-toc-title" class="post__toc-title h5">
      On this page
    </h2>

    <ol class="post__toc-list">
      {items.map((h) => (
        <li class={`post__toc-item post__toc-item--d${h.depth}`}>
          <a href={`#${h.slug}`} class="post__toc-link">
            {h.text}
          </a>
        </li>
      ))}
    </ol>
  </nav>
)}
