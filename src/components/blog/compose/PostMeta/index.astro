---
// src/components/blog/compose/PostMeta/index.astro
import css from "./PostMeta.css?url";

type DateLike = string | Date;

interface PostMetaProps {
  date?: DateLike;
  updated?: DateLike;
  author?: string;
  readingTime?: number; // minutes
}

const { date, updated, author, readingTime } = Astro.props as PostMetaProps;

const toDate = (d?: DateLike) => (d ? new Date(d) : undefined);

const published = toDate(date);
const modified = toDate(updated);

const fmt = (d?: Date) =>
  d
    ? new Intl.DateTimeFormat("en-GB", {
        year: "numeric",
        month: "short",
        day: "2-digit",
      }).format(d)
    : null;

const iso = (d?: Date) => (d ? d.toISOString() : undefined);

const showUpdated =
  published && modified ? modified.getTime() > published.getTime() : Boolean(modified);

const hasMeta = Boolean(
  published ||
    showUpdated ||
    author ||
    (typeof readingTime === "number" && readingTime > 0),
);
---
<link rel="stylesheet" href={css} />

{hasMeta && (
  <dl class="post__meta" role="group" aria-label="Article metadata">
    {published && (
      <>
        <dt>Published</dt>
        <dd>
          <time datetime={iso(published)} itemprop="datePublished">
            {fmt(published)}
          </time>
        </dd>
      </>
    )}

    {showUpdated && modified && (
      <>
        <dt>Updated</dt>
        <dd>
          <time datetime={iso(modified)} itemprop="dateModified">
            Updated {fmt(modified)}
          </time>
        </dd>
      </>
    )}

    {author && (
      <>
        <dt>Author</dt>
        <dd itemprop="author" itemscope itemtype="https://schema.org/Person">
          <span itemprop="name">{author}</span>
        </dd>
      </>
    )}

    {typeof readingTime === "number" && readingTime > 0 && (
      <>
        <dt>Reading time</dt>
        <dd>{readingTime} min read</dd>
      </>
    )}
  </dl>
)}
