---
// File: src/components/blog/compose/EditorsPicks/index.astro
/**
 * EditorsPicks — curated 3-post strip.
 * Props:
 *  - posts: Array<{ url: string; frontmatter: {
 *      title: string; description?: string; date: string|Date;
 *      readingTime?: number; category?: string;
 *      cover?: { src: string; alt?: string; width?: number; height?: number }
 *    }}>
 *  - eyebrow?: string
 *  - title?: string
 */
export interface Cover {
  src: string;
  alt?: string;
  width?: number;
  height?: number;
}

export interface FM {
  title: string;
  description?: string;
  date: string | Date;
  readingTime?: number;
  category?: string;
  cover?: Cover;
}

export interface Post {
  url: string;
  frontmatter: FM;
}

export interface Props {
  posts: Post[];
  eyebrow?: string;
  title?: string;
}

const {
  posts = [],
  eyebrow = "Curated",
  title = "Editors’ picks",
} = Astro.props as Props;

const fmt = (d: string | Date) =>
  new Date(d).toLocaleDateString("en-KE", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });

// Local component CSS only (per Fix Plan 155)
import css from "./EditorsPicks.css?url";
---
{posts.length > 0 && (
  <>
    <link rel="stylesheet" href={css} />

    <section class="ep" aria-label="Editors’ picks">
      <div class="container">
        <div class="ep__surface">
          <header class="ep__head">
            {eyebrow && <p class="ep__eyebrow">{eyebrow}</p>}

            {title && (
              <h2 class="ep__title section-title h2">
                {title}
              </h2>
            )}
          </header>

          <div class="ep__grid">
            {posts.slice(0, 3).map((p, i) => {
              const fm = p.frontmatter;
              const hasCover = Boolean(fm?.cover?.src);

              return (
                <article class="ep__card">
                  {hasCover && (
                    <a
                      href={p.url}
                      class="ep__media"
                      aria-label={`Read ${fm.title}`}
                    >
                      <img
                        src={fm.cover!.src}
                        alt={fm.cover?.alt ?? fm.title}
                        width={fm.cover?.width ?? 640}
                        height={fm.cover?.height ?? 360}
                        loading={i < 1 ? "eager" : "lazy"}
                        decoding="async"
                      />
                    </a>
                  )}

                  <div class="ep__body">
                    {fm?.category && (
                      <p class="ep__cat">{fm.category}</p>
                    )}

                    <h3 class="ep__cardTitle">
                      <a href={p.url}>{fm.title}</a>
                    </h3>

                    {fm?.description && (
                      <p class="ep__excerpt clamp-3">
                        {fm.description}
                      </p>
                    )}

                    <p class="ep__meta">
                      <time
                        datetime={new Date(
                          fm.date
                        ).toISOString()}
                      >
                        {fmt(fm.date)}
                      </time>
                      {typeof fm?.readingTime === "number" && (
                        <>
                          {" "}
                          · {fm.readingTime} min read
                        </>
                      )}
                    </p>
                  </div>
                </article>
              );
            })}
          </div>
        </div>
      </div>
    </section>
  </>
)}
